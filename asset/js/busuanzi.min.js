// (()=>{if(window.busuanziRequestSent)return;window.busuanziRequestSent=true;const u=new URL('https://cdn.busuanzi.cc/');fetch(u.protocol+'//'+u.host+'/api.php',{method:'POST',body:JSON.stringify({url:location.href,referrer:document.referrer})}).then(r=>r.json()).then(r=>{for(const k in r)document.querySelectorAll('#'+k).forEach(e=>e.innerText=r[k])}).catch(e=>console.error(e))})()

var bszCaller, bszTag;
!function () {
    var c, d, e, a = !1, b = [];
    ready = function (c) {
        return a || "interactive" === document.readyState || "complete" === document.readyState ? c.call(document) : b.push(function () { return c.call(this) }), this
    }, d = function () {
        for (var a = 0, c = b.length; c > a; a++) b[a].apply(document);
        b = []
    }, e = function () {
        a || (a = !0, d.call(window),
            document.removeEventListener ? document.removeEventListener("DOMContentLoaded", e, !1) : document.attachEvent && (document.detachEvent("onreadystatechange", e), window == window.top && (clearInterval(c), c = null)))
    }, document.addEventListener ? document.addEventListener("DOMContentLoaded", e, !1) : document.attachEvent && (document.attachEvent("onreadystatechange", function () { /loaded|complete/.test(document.readyState) && e() }),
        window == window.top && (c = setInterval(function () { try { a || document.documentElement.doScroll("left") } catch (b) { return } e() }, 5)))
}(),

    bszCaller = {
        fetch: function (a, b) {
            // 修改为使用新的API端点
            if (window.busuanziRequestSent) return;
            window.busuanziRequestSent = true;

            var c = "BusuanziCallback_" + Math.floor(1099511627776 * Math.random());
            window[c] = this.evalCall(b);

            // 使用新的API地址
            const u = new URL('https://cdn.busuanzi.cc/');
            fetch(u.protocol + '//' + u.host + '/api.php', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    url: location.href,
                    referrer: document.referrer
                })
            })
                .then(r => r.json())
                .then(r => {
                    // 调用回调函数处理返回的数据
                    window[c](r);
                })
                .catch(e => {
                    console.error(e);
                    // 出错时隐藏统计容器
                    bszTag.hides();
                });
        },

        evalCall: function (a) {
            return function (b) {
                ready(function () {
                    try {
                        a(b);
                    } catch (c) {
                        bszTag.hides();
                    }
                })
            }
        }
    },

    // 触发API请求
    bszCaller.fetch("", function (a) {
        bszTag.texts(a);
        bszTag.shows();
    }),

    bszTag = {
        bszs: ["site_pv", "page_pv", "site_uv"],
        texts: function (a) {
            this.bszs.map(function (b) {
                var c = document.getElementById("busuanzi_value_" + b);
                if (c) {
                    var value = a[b] || '0';
                    c.innerHTML = numberToImageTags(String(value));
                }
            })
        },
        hides: function () {
            this.bszs.map(function (a) {
                var b = document.getElementById("busuanzi_container_" + a);
                b && (b.style.display = "none")
            })
        },
        shows: function () {
            this.bszs.map(function (a) {
                var b = document.getElementById("busuanzi_container_" + a);
                b && (b.style.display = "inline")
            })
        }
    };